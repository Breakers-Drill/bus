# Bus Monitor Generator Service

Микросервисное приложение для генерации тестовых сообщений в формате PLC данных.

## Архитектура

Приложение построено на микросервисной архитектуре с использованием следующих компонентов:

### GeneratorService
- Генерирует тестовые сообщения каждые 500ms
- Создает JSON сообщения с данными PLC в формате `DC_out_100ms[xxx]`
- Использует абстрактный `BusService` для отправки сообщений

### BusService (Абстрактный класс)
- Определяет интерфейс для обработки сообщений
- Методы: `initialize()`, `processMessage()`, `shutdown()`

### ConsoleBusService
- Конкретная реализация `BusService`
- Выводит все входящие сообщения в консоль с временными метками

## Структура проекта

```
generator/
├── src/
│   ├── services/
│   │   ├── BusService.js          # Абстрактный класс
│   │   ├── ConsoleBusService.js   # Консольная реализация
│   │   ├── MqttBusService.js      # MQTT реализация
│   │   └── GeneratorService.js    # Генератор сообщений
│   └── index.js                   # Основное приложение
├── package.json
└── README.md
```

## Установка и запуск

1. Установите зависимости:
```bash
npm install
```

2. Запустите приложение:
```bash
npm start
```

Или для разработки с автоматической перезагрузкой:
```bash
npm run dev
```

## Формат генерируемых сообщений

Каждое сообщение содержит:
- `topic`: "PLC/test"
- `payload`: Объект с данными PLC

Пример сообщения:
```json
{
  "topic": "PLC/test",
  "payload": {
    "DC_out_100ms[144]": 1,
    "DC_out_100ms[146]": 0,
    "DC_out_100ms[148]": "25.3",
    "DC_out_100ms[164]": "45.7",
    "DC_out_100ms[165]": "12.8",
    "DC_out_100ms[140].8": 75,
    "DC_out_100ms[140].10": "2.3",
    "DC_out_100ms[140].9": "98.5",
    "DC_out_100ms[141].10": "156.2",
    "DC_out_100ms[141].8": 0,
    "DC_out_100ms[141].9": "42.1",
    "DC_out_100ms[140].13": "7.8",
    "DC_out_100ms[140].14": 234,
    "DC_out_100ms[141].13": "28.9"
  }
}
```

## Остановка приложения

Нажмите `Ctrl+C` для корректного завершения работы приложения.

## Расширение функциональности

Для добавления новых способов обработки сообщений создайте новый класс, наследующий от `BusService`:

```javascript
const BusService = require('./services/BusService');

class CustomBusService extends BusService {
    async initialize() {
        // Инициализация
    }
    
    processMessage(message) {
        // Обработка сообщения
    }
    
    async shutdown() {
        // Завершение работы
    }
}
``` 