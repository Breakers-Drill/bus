# Bus Monitor - MQTT Bridge Setup

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç MQTT –º–æ—Å—Ç –º–µ–∂–¥—É –¥–≤—É–º—è –±—Ä–æ–∫–µ—Ä–∞–º–∏:
- **mqtt-edge** (producer) - –Ω–∞ –ø–æ—Ä—Ç—É 1883
- **mqtt-cloud** (consumer) - –Ω–∞ –ø–æ—Ä—Ç—É 1884

## –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Docker –∏ Docker Compose —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
- –ü–æ—Ä—Ç—ã 1883 –∏ 1884 —Å–≤–æ–±–æ–¥–Ω—ã –Ω–∞ —Ö–æ—Å—Ç–µ

## –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–û—Å–Ω–æ–≤–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:

- `MQTT_TOPIC` - —Ç–æ–ø–∏–∫ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏/–ø–æ–ª—É—á–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `PLC/test`)
- `MQTT_BROKER_URL` - URL MQTT –±—Ä–æ–∫–µ—Ä–∞
- `MQTT_CLIENT_ID` - ID MQTT –∫–ª–∏–µ–Ω—Ç–∞

üìñ **–ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: [ENVIRONMENT.md](ENVIRONMENT.md)

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### 1. –°–æ–∑–¥–∞–Ω–∏–µ –æ–±—â–µ–π Docker —Å–µ—Ç–∏

```bash
docker network create bus-monitor-network
```

### 2. –ó–∞–ø—É—Å–∫ Producer (Edge –±—Ä–æ–∫–µ—Ä)

```bash
cd producer
docker-compose up -d
```

Producer –∑–∞–ø—É—Å—Ç–∏—Ç:
- MQTT –±—Ä–æ–∫–µ—Ä –Ω–∞ –ø–æ—Ä—Ç—É 1883
- Generator —Å–µ—Ä–≤–∏—Å –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### 3. –ó–∞–ø—É—Å–∫ Consumer (Cloud –±—Ä–æ–∫–µ—Ä + Monitor)

```bash
cd consumer
docker-compose up -d
```

Consumer –∑–∞–ø—É—Å—Ç–∏—Ç:
- MQTT –±—Ä–æ–∫–µ—Ä –Ω–∞ –ø–æ—Ä—Ç—É 1884
- MQTT Monitor –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ç–µ–π
```bash
docker network ls
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
```bash
docker ps
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤
```bash
# Producer logs
docker logs mqtt-edge

# Consumer logs  
docker logs bus-monitor-mqtt-cloud
```

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ MQTT –º–æ—Å—Ç–∞

–û—Ç–ø—Ä–∞–≤—å—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –Ω–∞ producer (–ø–æ—Ä—Ç 1883):
```bash
mosquitto_pub -h localhost -p 1883 -t "test/topic" -m "Hello from producer"
```

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–æ—à–ª–æ –¥–æ consumer (–ø–æ—Ä—Ç 1884):
```bash
mosquitto_sub -h localhost -p 1884 -t "test/topic"
```

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Producer      ‚îÇ    ‚îÇ   Consumer      ‚îÇ
‚îÇ   mqtt-edge     ‚îÇ‚óÑ‚îÄ‚îÄ‚ñ∫‚îÇ   mqtt-cloud    ‚îÇ
‚îÇ   bus-generator ‚îÇ    ‚îÇ   bus-monitor   ‚îÇ
‚îÇ   Port: 1883    ‚îÇ    ‚îÇ   Port: 1884    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

- Producer –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –Ω–∞ consumer —á–µ—Ä–µ–∑ MQTT –º–æ—Å—Ç
- –ü—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ consumer, producer –∫—ç—à–∏—Ä—É–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è
- –ú–æ—Å—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –ø—Ä–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å–≤—è–∑–∏

## –û—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å consumer
cd consumer && docker-compose down

# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å producer  
cd producer && docker-compose down

# –£–¥–∞–ª–∏—Ç—å —Å–µ—Ç—å (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
docker network rm bus-monitor-network
``` 